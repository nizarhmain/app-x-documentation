<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>My app documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">My app documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>SyncProvider</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/services/sync-provider.ts</code>
        </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#alertCtrl">alertCtrl</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#db">db</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#file">file</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#global">global</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#loadCtrl">loadCtrl</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#platform">platform</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#rest">rest</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#tools">tools</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getRigheRecursive">getRigheRecursive</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#sqlRespToArray">sqlRespToArray</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateDBdata">updateDBdata</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(global: <a href="../injectables/GlobalProvider.html">GlobalProvider</a>, rest: <a href="../injectables/RestProvider.html">RestProvider</a>, db: <a href="../injectables/DbProvider.html">DbProvider</a>, file: <a href="../injectables/FileProvider.html">FileProvider</a>, platform: Platform, alertCtrl: AlertController, loadCtrl: LoadingController, storageRam: <a href="../injectables/StoreClientsInRamService.html">StoreClientsInRamService</a>, tools: <a href="../injectables/ToolsProvider.html">ToolsProvider</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="17" class="link-to-prism">src/app/services/sync-provider.ts:17</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>global</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/GlobalProvider.html" target="_self" >GlobalProvider</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>rest</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/RestProvider.html" target="_self" >RestProvider</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>db</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/DbProvider.html" target="_self" >DbProvider</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>file</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/FileProvider.html" target="_self" >FileProvider</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>platform</td>
                                                  
                                                        <td>
                                                                    <code>Platform</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>alertCtrl</td>
                                                  
                                                        <td>
                                                                    <code>AlertController</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>loadCtrl</td>
                                                  
                                                        <td>
                                                                    <code>LoadingController</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>storageRam</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/StoreClientsInRamService.html" target="_self" >StoreClientsInRamService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>tools</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ToolsProvider.html" target="_self" >ToolsProvider</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getRigheRecursive"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Private</span>
                            getRigheRecursive
                        </b>
                        <a href="#getRigheRecursive"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getRigheRecursive(testate: TestataOrdine[], righe: any[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="315"
                            class="link-to-prism">src/app/services/sync-provider.ts:315</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>testate</td>
                                    <td>
                                            <code>TestataOrdine[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>righe</td>
                                    <td>
                                            <code>any[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any[]&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sqlRespToArray"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Private</span>
                            sqlRespToArray
                        </b>
                        <a href="#sqlRespToArray"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sqlRespToArray(resp: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="327"
                            class="link-to-prism">src/app/services/sync-provider.ts:327</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>resp</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Array&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateDBdata"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            updateDBdata
                        </b>
                        <a href="#updateDBdata"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateDBdata()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="33"
                            class="link-to-prism">src/app/services/sync-provider.ts:33</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="alertCtrl"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            alertCtrl</b>
                            <a href="#alertCtrl"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>AlertController</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="24" class="link-to-prism">src/app/services/sync-provider.ts:24</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="db"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            db</b>
                            <a href="#db"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../injectables/DbProvider.html" target="_self" >DbProvider</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/app/services/sync-provider.ts:21</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="file"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            file</b>
                            <a href="#file"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../injectables/FileProvider.html" target="_self" >FileProvider</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="22" class="link-to-prism">src/app/services/sync-provider.ts:22</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="global"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            global</b>
                            <a href="#global"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../injectables/GlobalProvider.html" target="_self" >GlobalProvider</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/app/services/sync-provider.ts:19</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="loadCtrl"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            loadCtrl</b>
                            <a href="#loadCtrl"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>LoadingController</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">src/app/services/sync-provider.ts:25</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="platform"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            platform</b>
                            <a href="#platform"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>Platform</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="23" class="link-to-prism">src/app/services/sync-provider.ts:23</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="rest"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            rest</b>
                            <a href="#rest"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../injectables/RestProvider.html" target="_self" >RestProvider</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="20" class="link-to-prism">src/app/services/sync-provider.ts:20</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="tools"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            tools</b>
                            <a href="#tools"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="../injectables/ToolsProvider.html" target="_self" >ToolsProvider</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="27" class="link-to-prism">src/app/services/sync-provider.ts:27</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
//import &#x27;rxjs/add/operator/map&#x27;;
//import &#x27;rxjs/add/operator/toPromise&#x27;;

import { GlobalProvider } from &#x27;./global-provider&#x27;;
import { RestProvider } from &#x27;./rest-provider&#x27;;
import { DbProvider } from &#x27;./db-provider&#x27;;
import { FileProvider } from &#x27;./file-provider&#x27;;
import { ToolsProvider } from &#x27;./tool-provider&#x27;;

import { AlertController, LoadingController, Platform } from &#x27;@ionic/angular&#x27;;

import { TestataOrdine, Settings } from &#x27;../../app/app.model&#x27;;
import { StoreClientsInRamService } from &#x27;./store-clients-in-ram.service&#x27;;

@Injectable()
export class SyncProvider {

	constructor(public global:        GlobalProvider,
							public rest:          RestProvider,
							public db:            DbProvider,
							public file:          FileProvider,
							public platform:      Platform,
							public alertCtrl:     AlertController,
							public loadCtrl:      LoadingController,
							private storageRam: StoreClientsInRamService,
							public tools:         ToolsProvider) {
		this.global.log(&#x27;SyncProvider.constructor() - started&#x27;);
	}


// wtf
	async updateDBdata(): Promise&lt;any&gt; {

		// set codice agente to SQLITE and save it there once the Save button was clicked

		const loading &#x3D; await this.loadCtrl.create({
			cssClass: &#x27;loadingPopUp&#x27;,
			mode: &#x27;ios&#x27;,
			spinner: &#x27;crescent&#x27;,
			message: &#x27;Caricamento di clienti, articoli, destinatari&#x27;,
		  });

		await loading.present();

		let codiceAgente &#x3D; await this.rest.getCodiceAgente();

		// save the codice aggente to settings
		this.db.setSetting(&#x27;codage&#x27;, codiceAgente);
		this.global.log(&#x27;SyncProvider.updateDBdata() - Codice Agente salvato&#x27;);

		// caricamento impostazioni
		//already done but not sure if necessary here to be honest


		let clienti &#x3D; await this.rest.getClienti(codiceAgente);

		this.storageRam.setClienti(clienti)
		// after receiving the clienti, we need to store them in sqlite
		this.global.log(&#x27;SyncProvider.updateDBdata() - Clienti scaricati: n. &#x27; + clienti.length);

		// preemptively store in the cache ram already

		console.log(&#x27;Aggiornamento dati DB: Eliminazione Clienti&#x27;);


		// Promise.all([this.db.deleteAllClienti(),
		// 			 this.db.insertClienti(clienti),
		// 			])

		// caricamento destinatari
		let destinatari &#x3D; await this.rest.getDestinatari(codiceAgente);
		this.global.log(&#x27;SyncProvider.updateDBdata() - Destinatari scaricati: n. &#x27; + destinatari.length);
		console.log(&#x27;Aggiornamento dati DB: Eliminazione Destinatari&#x27;);

		// Promise.all([this.db.deleteAllDestinatari(),
		// 			 this.db.insertDestinatari(destinatari),
		// 			   ])

		// caricamento degli articoli
		let articoli &#x3D; await this.rest.getArticoli(codiceAgente);
		// Promise.all([this.db.deleteAllArticoli(),
		// 			 this.db.insertArticoli(articoli),
		// 			  ])

		let preferiti &#x3D; await this.rest.getPreferiti(codiceAgente)
		/* Promise.all([this.db.deleteAllPreferiti(),
					 this.db.insertPreferiti(preferiti),
					 ]) */

		let marche &#x3D; await this.rest.getMarche()
		this.global.log(&#x27;SyncProvider.updateDBdata() - Marche scaricate n. &#x27; + marche.length);
		console.log(&#x27;Aggiornamento dati DB: Marche&#x27;);
		//this.db.insertMarca(marche)

		let numOrdini &#x3D; await this.rest.getNumOrdini()
		//this.db.setNumOrdini(numOrdini)

		return Promise.all([
					this.db.deleteAllClienti(),
					this.db.insertClienti(clienti),
					this.db.deleteAllDestinatari(),
					this.db.insertDestinatari(destinatari),
					this.db.deleteAllArticoli(),
					this.db.insertArticoli(articoli),
					this.db.deleteAllPreferiti(),
					this.db.insertPreferiti(preferiti),
					this.db.insertMarca(marche),
					this.db.setNumOrdini(numOrdini)
		   ]).then( async () &#x3D;&gt; await loading.dismiss())



		return codiceAgente

/*

		this.global.log(&#x27;SyncProvider.updateDBdata() - started&#x27;);
		//let loader &#x3D; this.tools.getLoader(&#x27;Recupero codice agente&#x27;);
		//loader.present();
		return this.rest.getCodiceAgente().then((codiceAgente) &#x3D;&gt; {
			this.global.log(&#x27;SyncProvider.updateDBdata() - Codice Agente recuperato: &#x27; + codiceAgente);
			console.log(&#x27;Aggiornamento codice agente&#x27;);
			return this.db.setSetting(&#x27;codage&#x27;, codiceAgente).then(() &#x3D;&gt; {
				this.global.log(&#x27;SyncProvider.updateDBdata() - Codice Agente salvato&#x27;);
				console.log(&#x27;Caricamento impostazioni&#x27;);
				return this.db.loadSettings().then((settings) &#x3D;&gt; {
					this.global.setSettings(settings);
					this.global.log(&#x27;SyncProvider.updateDBdata() - Impostazioni caricate: &#x27; + JSON.stringify(settings));
					console.log(&#x27;Download dati da server: Clienti&#x27;);
					return this.rest.getClienti(settings.codiceAgente).then((clienti) &#x3D;&gt; {
						this.global.log(&#x27;SyncProvider.updateDBdata() - Clienti scaricati: n. &#x27; + clienti.length);
						console.log(&#x27;Aggiornamento dati DB: Eliminazione Clienti&#x27;);
						return this.db.deleteAllClienti().then(() &#x3D;&gt; {
							this.global.log(&#x27;SyncProvider.updateDBdata() - Clienti eliminati&#x27;);
							console.log(&#x27;Aggiornamento dati DB: Clienti&#x27;);
							return this.db.insertClienti(clienti).then(() &#x3D;&gt; {
								this.global.log(&#x27;SyncProvider.updateDBdata() - Clienti inseriti nel DB&#x27;);
								console.log(&#x27;Download dati da server: Destinatari&#x27;);
								return this.rest.getDestinatari(settings.codiceAgente).then((destinatari) &#x3D;&gt; {
									this.global.log(&#x27;SyncProvider.updateDBdata() - Destinatari scaricati: n. &#x27; + destinatari.length);
									console.log(&#x27;Aggiornamento dati DB: Eliminazione Destinatari&#x27;);
									return this.db.deleteAllDestinatari().then(() &#x3D;&gt; {
										this.global.log(&#x27;SyncProvider.updateDBdata() - Destinatari eliminati.&#x27;);
										console.log(&#x27;Aggiornamento dati DB: Destinatari&#x27;);
										return this.db.insertDestinatari(destinatari).then(() &#x3D;&gt; {
											this.global.log(&#x27;SyncProvider.updateDBdata() - Destinatari inseriti nel DB&#x27;);
											console.log(&#x27;Download dati da server: Articoli&#x27;);
											return this.rest.getArticoli(settings.codiceAgente).then((articoli) &#x3D;&gt; {
												this.global.log(&#x27;SyncProvider.updateDBdata() - Articoli scaricati n. &#x27; + articoli.length);
												console.log(&#x27;Aggiornamento dati DB: Eliminazione Articoli&#x27;);
												return this.db.deleteAllArticoli().then(() &#x3D;&gt; {
													this.global.log(&#x27;SyncProvider.updateDBdata() - Articoli Eliminati&#x27;);
													console.log(&#x27;Aggiornamento dati DB: Articoli&#x27;);
													return this.db.insertArticoli(articoli).then(() &#x3D;&gt; {
														this.global.log(&#x27;SyncProvider.updateDBdata() - Articoli inseriti nel DB&#x27;);
														console.log(&#x27;Download dati da server: Preferiti&#x27;);
														return this.rest.getPreferiti(settings.codiceAgente).then(preferiti &#x3D;&gt; {
															this.global.log(&#x27;SyncProvider.updateDBdata() - Preferiti scaricati: n. &#x27; + preferiti.length);
															console.log(&#x27;Aggiornamento dati DB: Eliminazione Preferiti&#x27;);
															return this.db.deleteAllPreferiti().then(() &#x3D;&gt; {
																this.global.log(&#x27;SyncProvider.updateDBdata() - Preferiti eliminati.&#x27;);
																console.log(&#x27;Aggiornamento dati DB: Preferiti&#x27;);
																return this.db.insertPreferiti(preferiti).then(() &#x3D;&gt; {
																	this.global.log(&#x27;SyncProvider.updateDBdata() - Preferiti inseriti nel DB&#x27;);
																	console.log(&#x27;Download dati da server: Marche&#x27;);
																	return this.rest.getMarche().then((marche) &#x3D;&gt; {
																		this.global.log(&#x27;SyncProvider.updateDBdata() - Marche scaricate n. &#x27; + marche.length);
																		console.log(&#x27;Aggiornamento dati DB: Marche&#x27;);
																		return this.db.insertMarca(marche).then(() &#x3D;&gt; {
																			this.global.log(&#x27;SyncProvider.updateDBdata() - Marche inserite nel DB&#x27;);
																			console.log(&#x27;Download dati da server: Numeri Ordini&#x27;);
																			return this.rest.getNumOrdini().then((numOrdini) &#x3D;&gt; {
																				this.global.log(&#x27;SyncProvider.updateDBdata() - Numeri ordini scaricati n. &#x27; + numOrdini.length);
																				console.log(&#x27;Aggiornamento dati DB: Numeri Ordini&#x27;);
																				return this.db.setNumOrdini(numOrdini).then(() &#x3D;&gt; {
																					this.global.log(&#x27;SyncProvider.updateDBdata() - Numeri Ordini aggiornati&#x27;);
																					console.log(&#x27;ok we done i think&#x27;);
																					/*
																					loader.dismiss().then(() &#x3D;&gt; {
																						return Promise.resolve();
																					});

																				});
																			});
																		});
																	});
																});
															});
														});
													});
												});
											});
										});
									});
								});
							});
						});
					});
				});
			}); // .catch(err &#x3D;&gt; this.global.log(&#x27;SyncProvider.updateDBdata() - Error catched: &#x27; + err.message))
		}).catch(err &#x3D;&gt; {
			this.global.log(&#x27;SyncProvider.updateDBdata() - Errore durante l\&#x27;aggiornamento dei dati del DB&#x27;);
			let myerr &#x3D; this.tools.parseError(err, 4, &#x27;Errore durante l\&#x27;aggiornamento dei dati del DB&#x27;);
			console.log(&#x27;there was an error&#x27;);
			/*
			return loader.dismiss().then(() &#x3D;&gt; {
				return Promise.reject(myerr);
			});

		});

*/

	}

	// IMPLEMENT THIS METHOD
	/*
	downloadImmagini() {
		this.global.log(&#x27;SyncProvider.downloadImmagini() - started&#x27;);
		let loader &#x3D; this.tools.getLoader(&#x27;Download dati da server: Metadata Immagini&#x27;);
		loader.present();
		return this.rest.getImmagini().then((immagini) &#x3D;&gt; {
			this.global.log(&#x27;SyncProvider.downloadImmagini() - Metadata Immagini scaricati n. &#x27; + immagini.length);
			loader.setContent(&#x27;Aggiornamento dati DB: Metadata Immagini&#x27;);
			return this.db.insertImmagini(immagini).then(() &#x3D;&gt; {
				this.global.log(&#x27;SyncProvider.downloadImmagini() - Metadata Immagini inseriti nel DB&#x27;);
				return this.file.getImagesDir().then(dir &#x3D;&gt; {
					this.global.log(&#x27;SyncProvider.downloadImmagini() - Images dir: &#x27; + dir);
					return this.db.getAllImmagini().then((immagini) &#x3D;&gt; {
						this.global.log(&#x27;SyncProvider.downloadImmagini() - immagini.length: &#x27; + immagini.length);
						loader.setContent(&#x27;Download immagini...&#x27;)
						if(immagini.length &lt; 1) {
							this.global.log(&#x27;SyncProvider.downloadImmagini() - immagini.length &lt; 1: true&#x27;);
							return Promise.reject({level: 1, message: &#x27;Non ci sono metadati per le immagini nel database&#x27;});
						}
						let baseurl &#x3D; this.global.getSettings().server;
						baseurl &#x3D; this.tools.urlHttpProtocol(baseurl);
						baseurl &#x3D; this.tools.urlEndSlash(baseurl);
						return this.file.downloadImmagini(baseurl, immagini).then(() &#x3D;&gt; {
							loader.dismiss();
							return Promise.resolve();
						});
					});
				});
			});
		}).catch(err &#x3D;&gt; {
			loader.dismiss();
			let myerr &#x3D; this.tools.parseError(err, 1, &#x27;Errore durante il download delle immagini&#x27;);
			let alert &#x3D; this.alertCtrl.create({
				title: &#x27;Errore Download Immagini&#x27;,
				message: myerr.message,
				buttons: [
					{
						text: &#x27;OK&#x27;,
						role: &#x27;cancel&#x27;,
					}
				]
			});
			alert.present();
			return Promise.resolve();
		});
	}

	// IMPLEMENT THIS OTHER METHOD
	loadOrdini() {
		this.global.log(&#x27;SyncProvider.loadOrdini() - started&#x27;);
		let loader &#x3D; this.tools.getLoader(&#x27;Recupero Righe Ordini...&#x27;);
		loader.present();
		return this.db.getTestateDaInviare().then(testate &#x3D;&gt; {
			return this.getRigheRecursive(testate, []).then(righeordinesql &#x3D;&gt; {
				loader.setContent(&#x27;Recupero Testate Ordini...&#x27;);
				return this.db.getAllTestateSQL().then(testatesql &#x3D;&gt; {
					loader.setContent(&#x27;Caricamento Testate Ordini...&#x27;);
					return this.rest.loadTestate(this.sqlRespToArray(testatesql)).then(() &#x3D;&gt; {
						loader.setContent(&#x27;Caricamento Righe Ordini...&#x27;);
						return this.rest.loadRigheOrdine(righeordinesql).then(() &#x3D;&gt; {
							return this.db.setInviatoTestate().then(() &#x3D;&gt; {
								loader.dismiss().then(() &#x3D;&gt; {
									let alert &#x3D; this.alertCtrl.create({
										title: &#x27;Caricamento Ordini&#x27;,
										message: &#x27;Caricamento Ordini Completato&#x27;,
										buttons: [
											{
												text: &#x27;OK&#x27;,
												role: &#x27;cancel&#x27;
											}
										]
									});
									alert.present();
								});
							});
						});
					});
				});
			});
		}).catch(err &#x3D;&gt; {
			loader.dismiss();
			let myerr &#x3D; this.tools.parseError(err, 1, &#x27;Errore durante il caricamento degli ordini&#x27;);
			let alert &#x3D; this.alertCtrl.create({
				title: &#x27;Errore Caricamento Ordini&#x27;,
				message: myerr.message,
				buttons: [
					{
						text: &#x27;OK&#x27;,
						role: &#x27;cancel&#x27;,
					}
				]
			});
			alert.present();
			return Promise.resolve();
		});
	}
*/
	private getRigheRecursive(testate: TestataOrdine[], righe: any[]): Promise&lt;any[]&gt; {
		let t &#x3D; testate.shift();
		return this.db.getRigheOfOrdineSQL(t.cliente.codice, t.numOrdine).then(sqlrighe &#x3D;&gt; {
			if(testate.length &gt; 0) {
				return this.getRigheRecursive(testate, righe.concat(this.sqlRespToArray(sqlrighe)));
			}
			else {
				return righe.concat(this.sqlRespToArray(sqlrighe));
			}
		});
	}

	private sqlRespToArray(resp: any): Array&lt;any&gt; {
		let sqlarr: Array&lt;any&gt; &#x3D; [];
		for(let i &#x3D; 0; i &lt; resp.length; i++) {
			sqlarr.push(resp.item(i));
		}
		return sqlarr;
	}

}
</code></pre>
    </div>

</div>











                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'SyncProvider.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
